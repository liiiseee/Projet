package com.intiformation.gestionclients.servlet;

import java.io.IOException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.intiformation.gestionclients.dao.ClientDaoImpl;
import com.intiformation.gestionclients.dao.IClientDAO;
import com.intiformation.gestionclients.model.Client;

/**
 * servlet pour gestion du client
 * @author IN-DF-029
 *
 */
@WebServlet(name="GestionClientServlet", urlPatterns = {"/gestion-client-servlet"})
public class GestionClientServlet extends HttpServlet{

	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		
	}// end doGet()
	
	
	/*==============================================*/

	@Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		// 1. récup de la valeur du param 'action'
		String userAction = request.getParameter("action");
		
		//2. dao du client
		IClientDAO clientDAO = new ClientDaoImpl();
		
		// 2. vérif de la valeur du param action
		switch (userAction) {
		case "ajout": // si action = ajout
			// récup des paramètres de la requête (saisie du formulaire)
			String nom = request.getParameter("pNom");
			String prenom = request.getParameter("pPrenom");
			String adresse = request.getParameter("pAdresse");
			String ville = request.getParameter("pVille");
			String codePostal = request.getParameter("pCodePostal");
			String telephone = request.getParameter("pTelephone");
			
			// chargement des données dans un objet client
			Client client = new Client(nom, prenom, adresse, codePostal, ville, telephone);
			
			// appel de la dao pour ajouter le client dans la bdd
			clientDAO.ajouterClient(client);
			
			// redirection vers la page 'accueil.jsp' + sauvegarde de la nouvelle liste de clients dans la requête
			List<Client> listeClients = clientDAO.getAllClients();
			
			request.setAttribute("liste_clients", listeClients);
			
			request.getRequestDispatcher("/accueil.jsp").forward(request, response);
			
			
			break;

		default:
			break;
		}// end switch
		
	}// end doPost()
	
	

}
